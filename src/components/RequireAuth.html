{#if $login}
<slot />
{:else}
<p>You must log in to continue</p>
<Login />
{/if}

<script>
  import client from '../utils/feathers'
  export default {
    components: {
      Login: '../components/Login.html'
    },
    oncreate() {
      client.authenticate().catch(this.store.set({ login: null, user: null }))
      client.on('authenticated', async (res) => {
        this.store.set({ login: res.accessToken })
        const payload = await client.passport.verifyJWT(res.accessToken)
        const user = await client.service('users').get(payload.userId)
        this.store.set({ user })
      })
      // client.on('logout', this.logoutListener)
    },
    methods: {
      logoutListener() {
        store.set({ user: null, login: null })
      }
    }
  }
</script>