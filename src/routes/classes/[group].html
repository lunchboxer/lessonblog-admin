<svelte:head>
  <title>Orchardï¼š{groupName} class</title>
</svelte:head>

<h2>{groupName} class lessons</h2>

<div class="content">
  {#if group}

  <LessonsLoader {group} />

  {#if $showLessonSummaryForm}
  <LessonSummaryForm group={group._id} />
  {:else}
  <button on:click="$set({showLessonSummaryForm:true})">New lesson summary</button>
  {/if}

  {#if !$lessons}
  <p>Loading classes...</p>
  {:elseif $lessons.total === 0}
  <p>There aren't any lesson summaries for this class yet.</p>
  {:else}
  {#if $lessons.data[0].group === group._id}
  {#each $lessons.data as lesson (lesson._id)}
  <LessonSummary lesson="{lesson}" showMaterials="{topLesson === lesson._id}" />
  {/each}
  {/if}
  {/if}

  {:elseif $groups && $groups.length}
  <p>Could not find "{groupName} class".</p>
  {/if}

</div>

<script>
  import client from "../../utils/feathers.js";
  export default {
    components: {
      LessonSummary: "../../components/LessonSummary.html",
      LessonsLoader: "../../components/LessonsLoader.html",
      LessonSummaryForm: "../../components/LessonSummaryForm.html"
    },
    data() {
      return {
        error: null
      };
    },
    preload({ params, query }) {
      const { group } = params;
      return { groupName: group };
    },
    oncreate() {
      this.store.set({ lesson: null });
      const { group } = this.get();
      if (group) this.store.set({ group });
    },
    computed: {
      group: ({ $groups, groupName }) => {
        if ($groups) return $groups.find(group => group.name === groupName)
      },
      topLesson: ({ $lessons }) => {
        if ($lessons && $lessons.total > 0) return $lessons.data[0]._id;
      }
    }
  };
</script>